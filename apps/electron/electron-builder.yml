appId: com.mengko.agents
productName: Mengko Agents
copyright: Copyright Â© 2025 Mengko

electronVersion: "39.2.7"

# Hook to compile macOS 26+ Liquid Glass icon after packaging
afterPack: apps/electron/scripts/afterPack.cjs

directories:
  output: release
  buildResources: resources

files:
  - dist/**/*
  - "!dist/renderer/src/**"
  - "!**/*.map"
  - package.json
  # Include bundled MCP servers (bridge + session) for Codex sessions
  - resources/bridge-mcp-server/**/*
  - resources/session-mcp-server/**/*
  # Include Pi agent server subprocess for Pi SDK sessions
  - resources/pi-agent-server/**/*
  # Note: Bundled assets (docs, themes, permissions, tool-icons) are in resources/
  # and copied to dist/resources/ by build:copy. They're included via dist/**/* above.
  # Exclude everything from node_modules (will use extraResources for SDK)
  - "!node_modules/**/*"

extraMetadata:
  main: dist/main.cjs

# Auto-update: publish to GitHub Releases
publish:
  provider: github
  owner: Tonwed
  repo: mengko-agents

# Disable ASAR to avoid decompression overhead and click delays
asar: false

mac:
  category: public.app-category.productivity
  icon: resources/icon.icns
  # macOS 26+ Liquid Glass: Tell macOS to look for icon in Assets.car
  # The value must match --app-icon used in actool (see afterPack.js)
  extendInfo:
    CFBundleIconName: AppIcon
  target:
    - target: dmg
      arch:
        - arm64
        - x64
    - target: zip
      arch:
        - arm64
        - x64
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  # Use predictable naming for macOS packages (applies to zip; dmg uses its own config below)
  artifactName: "Mengko-Agent-${arch}.${ext}"
  # Code signing disabled for open source builds without certificates
  identity: null
  # Code signing & notarization (disabled by default for local builds)
  # To enable: set CSC_LINK, APPLE_ID, APPLE_APP_SPECIFIC_PASSWORD, APPLE_TEAM_ID
  # notarize:
  #   teamId: ${APPLE_TEAM_ID}

dmg:
  # Use predictable naming: Mengko-Agent-arm64.dmg, Mengko-Agent-x64.dmg
  artifactName: "Mengko-Agent-${arch}.dmg"
  # Custom background (multi-resolution TIFF with 1x+2x for retina support)
  background: resources/dmg-background.tiff
  # Use app icon as the mounted volume icon in Finder
  icon: resources/icon.icns
  iconSize: 80
  title: "Mengko Agents"
  contents:
    - x: 130
      y: 200
    - x: 410
      y: 200
      type: link
      path: /Applications
  window:
    width: 540
    height: 380

win:
  icon: resources/icon.ico
  target:
    - target: nsis
      arch:
        - x64
  # Use predictable naming: Mengko-Agent-x64.exe
  artifactName: "Mengko-Agent-${arch}.${ext}"

nsis:
  oneClick: true
  # Per-user install to %LOCALAPPDATA%\Programs\ (not Program Files).
  # Bun subprocess cannot read/write files in Program Files due to Windows permissions.
  perMachine: false
  deleteAppDataOnUninstall: true

linux:
  icon: resources/icon.png
  category: Utility
  maintainer: "Mengko <support@mengko.ai>"
  target:
    - target: AppImage
      arch:
        - x64
  artifactName: "Mengko-Agent-${arch}.${ext}"